# Тестовое задание

Текс задания в файле `PHP Developer.Test Case.pdf`

Решил разбить сервис на три части:
1. Поиск пользователей с истекающей подпиской и создание задач на отпрвавку уведомлений либо на проверку почты (если она еще не проверена).
2. Проверка почты на валидность (можно запускать в несколько потоков).
3. Отправка уведомлений на почту (можно запускать в несколько потоков).

### Запуск кода локально

> В init.sql задана генерация 5М пользователей,
> можно изменить это число на меньшее, 
> так как инитное кол-во проверок почты и уведомлений будет большое, а в моках зашиты таймауты.

Собрать образы
```shell
docker compose build notify check send
```

Запустить БД и дождать завершения init скрипты (создаст таблицы и сгенерирует тестовые данные)
```shell
docker compose up -d db
```

Запустить поиск пользователей с истекающей подпиской
```shell
docker compose run --rm notify
```

Запустить проверку почты (можно запустить вместе с notify)
```shell
docker compose up -d check
```

После завершения всех проверок можно заново запустить поиск пользователей (в проде запускается переодически по крону)
```shell
docker compose run --rm notify
```

Запустить отправка уведомлений
```shell
docker compose up -d send
```

Вариантов запуска в проде может быть несколько, как начиная с обычного сервера с кроном, так и в Kubernetes через CronJob.


